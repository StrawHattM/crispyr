% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/qc_and_process.R
\name{process_pooled_screen}
\alias{process_pooled_screen}
\title{Process Pooled CRISPR Screen FASTQ Files}
\usage{
process_pooled_screen(
  fastq_files,
  reference_library_csv,
  chip_file,
  sample_manifest_csv,
  barcode_policy = "PREFIX:CACCG@6",
  max_mismatches = 0,
  normalize = TRUE,
  output_dir = NULL,
  output_prefix = "crispyr_output",
  quiet = FALSE
)
}
\arguments{
\item{fastq_files}{Character vector of FASTQ file paths. Can be gzip-compressed.}

\item{reference_library_csv}{Path to the reference library CSV file
(see \code{\link[=load_reference_library]{load_reference_library()}}).}

\item{chip_file}{Path to the gene annotation chip file (see \code{\link[=load_chip_file]{load_chip_file()}}).}

\item{sample_manifest_csv}{Path to the sample manifest CSV file
(see \code{\link[=load_sample_manifest]{load_sample_manifest()}}).}

\item{barcode_policy}{Character. Barcode extraction policy string.
Format: "PREFIX:SEQUENCE@POSITION". Default: "PREFIX:CACCG@6" (Broad Institute).}

\item{max_mismatches}{Integer. Maximum mismatches for barcode matching. Default: 0 (exact).}

\item{normalize}{Logical. If \code{TRUE}, output log-normalized counts. Default: \code{TRUE}.}

\item{output_dir}{Character. Directory path for saving output files.
If NULL (default), files are not saved.}

\item{output_prefix}{Character. Prefix for output file names. Default: "crispyr_output".}

\item{quiet}{Logical. If \code{TRUE}, suppress progress messages. Default: \code{FALSE}.}
}
\value{
A list with elements:
\itemize{
\item \code{construct_counts}: Construct-level count matrix
\item \code{gene_counts}: Gene-level count matrix
\item \code{construct_lognorm}: Log-normalized construct counts (if \code{normalize = TRUE})
\item \code{gene_lognorm}: Log-normalized gene counts (if \code{normalize = TRUE})
\item \code{qc_metrics}: Quality control metrics
\item \code{feature_metadata}: Metadata for features (constructs/genes)
\item \code{sample_metadata}: Metadata for samples
}
}
\description{
Main wrapper function that orchestrates the complete CRISPR screen analysis pipeline:
FASTQ processing -> barcode extraction -> library matching -> gene mapping ->
count matrix generation -> normalization -> QC reporting.
}
\details{
\subsection{Pipeline Steps}{
\enumerate{
\item Extract construct (20bp) and sample (8bp) barcodes from FASTQ reads
\item Match construct barcodes to reference library
\item Map construct barcodes to target genes using chip file
\item Group reads by sample barcode and condition
\item Create construct-level and gene-level count matrices
\item Log-normalize counts (optional)
\item Calculate quality control metrics
}
}

\subsection{Output Files}{

If \code{output_dir} is specified, the following files are saved:
\itemize{
\item \verb{\{prefix\}_construct_counts.tsv}: Raw construct counts
\item \verb{\{prefix\}_gene_counts.tsv}: Raw gene counts
\item \verb{\{prefix\}_construct_lognorm.tsv}: Log-normalized construct counts
\item \verb{\{prefix\}_gene_lognorm.tsv}: Log-normalized gene counts
\item \verb{\{prefix\}_qc_overall.txt}: Overall QC metrics
\item \verb{\{prefix\}_qc_per_sample.tsv}: Per-sample QC metrics
}
}
}
\examples{
\dontrun{
  # Process a pooled CRISPR screen
  result <- process_pooled_screen(
    fastq_files = c("sample1.fastq.gz", "sample2.fastq.gz"),
    reference_library_csv = "CP0045_reference.csv",
    chip_file = "CP0045_GRCm38_strict.chip",
    sample_manifest_csv = "samples.csv",
    output_dir = "./results"
  )

  # Access results
  construct_counts <- result$construct_counts$matrix
  gene_counts <- result$gene_counts$matrix
}

}
