% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/count_and_normalize.R
\name{create_count_matrix}
\alias{create_count_matrix}
\title{Create Count Matrix}
\usage{
create_count_matrix(
  aggregated_reads,
  level = c("construct", "gene"),
  include_unmatched = FALSE,
  quiet = FALSE
)
}
\arguments{
\item{aggregated_reads}{A data.table from \code{\link[=aggregate_by_sample_barcode]{aggregate_by_sample_barcode()}}
with construct/gene mappings and condition assignments.}

\item{level}{Character. Level of aggregation for the count matrix.
\itemize{
\item "construct": Rows are construct barcodes (default, most fine-grained)
\item "gene": Rows are genes (aggregates multiple guides per gene)
}}

\item{include_unmatched}{Logical. If \code{TRUE}, include reads without gene/construct
assignment. Default: \code{FALSE}.}

\item{quiet}{Logical. If \code{TRUE}, suppress progress messages. Default: \code{FALSE}.}
}
\value{
A list with elements:
\itemize{
\item \code{matrix}: A count matrix (matrix class) with dimensions (constructs/genes  x  samples).
Rows are construct barcodes or genes, columns are samples/conditions.
\item \code{feature_metadata}: A data.frame with metadata for each row (barcode, construct_id, etc.)
\item \code{sample_metadata}: A data.frame with metadata for each column (condition, sample_barcode, etc.)
}
}
\description{
Constructs a count matrix (samples  x  constructs/genes) from mapped and
aggregated reads.
}
\details{
\subsection{Count Matrix Construction}{
\enumerate{
\item \strong{Construct-level} (\code{level = "construct"}):
Each row is a unique construct barcode. Multiple reads of the same
barcode in the same sample are summed.
\item \strong{Gene-level} (\code{level = "gene"}):
Each row is a unique gene (identified by gene_id). Reads mapping to
multiple guides (barcodes) targeting the same gene are summed across guides.
}
}
}
\examples{
\dontrun{
  # Create construct-level matrix
  construct_counts <- create_count_matrix(
    aggregated_reads,
    level = "construct"
  )

  # Create gene-level matrix
  gene_counts <- create_count_matrix(
    aggregated_reads,
    level = "gene"
  )
}

}
